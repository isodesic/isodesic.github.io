<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Showcase</title>
    <!-- PhotoSwipe CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.css">
    <style>
        /* Base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f9f9f9;
        }

        /* Main content container */
        .container {
            max-width: 1200px;
            width: 90%;
            margin: 0 auto;
            padding: 40px 0;
        }

        /* Typography */
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: #222;
        }

        p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        /* Images */
        .full-width-image {
            width: 100%;
            height: auto;
            margin-bottom: 2rem;
            display: block;
            cursor: pointer;
        }

        /* Image row */
        .image-row {
            display: flex;
            gap: 10px;
            margin-bottom: 2rem;
            width: 100%;
            overflow-x: auto; /* For mobile scrolling if needed */
        }

        .image-row img {
            height: 200px; /* Default height, will be adjusted by JS */
            width: auto; /* Auto width based on aspect ratio */
            object-fit: contain; /* Preserve aspect ratio without cropping */
            cursor: pointer;
        }

        /* Gallery wrapper for PhotoSwipe */
        .gallery {
            display: contents;
        }

        /* Custom caption container - outside of PhotoSwipe markup */
        .custom-caption-container {
            background: rgba(0, 0, 0, 0.75);
            color: #fff;
            position: absolute;
            text-align: left;
            padding: 15px;
            font-size: 16px;
            z-index: 9999;
            box-sizing: border-box;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .image-row {
                /* Maintain the row on mobile but allow scrolling if needed */
                flex-wrap: nowrap;
            }

            .image-row img {
                height: 120px; /* Default height for mobile, will be adjusted by JS */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project Title</h1>
        
        <p>First paragraph describing the project. This is a brief overview of what the project is about, its goals, and your role in it. Keep it concise but informative to give visitors an immediate understanding of what they're looking at.</p>
        
        <!-- Gallery wrapper -->
        <div class="gallery" id="my-gallery">
            <!-- Full-width images -->
            <a href="test_img/DSC03035.JPG" 
               data-pswp-width="1200" 
               data-pswp-height="800" 
               data-pswp-caption="Project overview - This is the caption for the first full-width image.">
                <img src="test_img/DSC03035.JPG" alt="Project overview" class="full-width-image">
            </a>
            
            <p>Second paragraph with more details about the project. This could include information about challenges faced, technologies used, or interesting aspects of the implementation process.</p>
            
            <a href="test_img/DSC03871(1200px).jpg" 
               data-pswp-width="1200" 
               data-pswp-height="800" 
               data-pswp-caption="Project details - This is the caption for the second full-width image showing more details.">
                <img src="test_img/DSC03871(1200px).jpg" alt="Project details" class="full-width-image">
            </a>
            
            <!-- First row of mixed images -->
            <div class="image-row">
                <a href="test_img/Tiger Wall UL 2 01.jpg" 
                   data-pswp-width="1200" 
                   data-pswp-height="900" 
                   data-pswp-caption="Detail 1 - Caption for the first image in the first row.">
                    <img src="test_img/Tiger Wall UL 2 01.jpg" alt="Detail 1">
                </a>
                <a href="test_img/IMG_4550.JPG" 
                   data-pswp-width="1200" 
                   data-pswp-height="900" 
                   data-pswp-caption="Detail 2 - Caption for the second image in the first row.">
                    <img src="test_img/IMG_4550.JPG" alt="Detail 2">
                </a>
                <a href="test_img/IMG_5054.JPG" 
                   data-pswp-width="1200" 
                   data-pswp-height="900" 
                   data-pswp-caption="Detail 3 - Caption for the third image in the first row.">
                    <img src="test_img/IMG_5054.JPG" alt="Detail 3">
                </a>
                <a href="test_img/DSC03871(1200px).jpg" 
                   data-pswp-width="1200" 
                   data-pswp-height="800" 
                   data-pswp-caption="Detail 4 - Caption for the fourth image in the first row.">
                    <img src="test_img/DSC03871(1200px).jpg" alt="Detail 4">
                </a>
            </div>
            
            <p>Third paragraph discussing further aspects of the project. You might want to highlight outcomes, user feedback, or lessons learned from the project experience.</p>
            
            <!-- Second row of mixed images -->
            <div class="image-row">
                <a href="test_img/IMG_4624.JPG" 
                   data-pswp-width="1200" 
                   data-pswp-height="900" 
                   data-pswp-caption="Additional detail 1 - Caption for the first image in the second row.">
                    <img src="test_img/IMG_4624.JPG" alt="Additional detail 1">
                </a>
                <a href="test_img/DSC03035.JPG" 
                   data-pswp-width="1200" 
                   data-pswp-height="800" 
                   data-pswp-caption="Additional detail 2 - Caption for the second image in the second row.">
                    <img src="test_img/DSC03035.JPG" alt="Additional detail 2">
                </a>
                <a href="test_img/Tiger Wall UL 2 01.jpg" 
                   data-pswp-width="1200" 
                   data-pswp-height="900" 
                   data-pswp-caption="Additional detail 3 - Caption for the third image in the second row.">
                    <img src="test_img/Tiger Wall UL 2 01.jpg" alt="Additional detail 3">
                </a>
            </div>
        </div>
        
        <p>Final thoughts or conclusion about the project. This could include information about future plans, improvements, or reflections on the project's impact.</p>
    </div>

    <!-- PhotoSwipe div element template (required) -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                            <div class="pswp__preloader__cut">
                                <div class="pswp__preloader__donut"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div>
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import PhotoSwipe from CDN
        import PhotoSwipeLightbox from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js';
        import PhotoSwipe from 'https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.esm.min.js';

        // Function to adjust image heights to fill row width
        function adjustImageRowHeights() {
            const imageRows = document.querySelectorAll('.image-row');
            const containerWidth = document.querySelector('.container').offsetWidth;
            const gap = 10; // Gap between images in pixels
            
            imageRows.forEach(row => {
                const images = Array.from(row.querySelectorAll('img'));
                
                // Wait for all images to load
                Promise.all(images.map(img => {
                    if (img.complete) return Promise.resolve();
                    return new Promise(resolve => {
                        img.onload = resolve;
                    });
                })).then(() => {
                    // Get natural aspect ratios of all images
                    const aspectRatios = images.map(img => img.naturalWidth / img.naturalHeight);
                    
                    // Calculate total width if all images had height=1px
                    const totalWidthAtUnitHeight = aspectRatios.reduce((sum, ratio) => sum + ratio, 0);
                    
                    // Calculate target height to fill container width (accounting for gaps)
                    const gapsWidth = (images.length - 1) * gap;
                    const targetHeight = (containerWidth - gapsWidth) / totalWidthAtUnitHeight;
                    
                    // Set heights of all images
                    images.forEach(img => {
                        img.style.height = `${targetHeight}px`;
                    });
                });
            });
        }

        // Initialize PhotoSwipe with caption support
        document.addEventListener('DOMContentLoaded', function() {
            // Run row height adjustment
            adjustImageRowHeights();
            
            // Initialize PhotoSwipe Lightbox with simpler config
            const lightbox = new PhotoSwipeLightbox({
                gallery: '#my-gallery',
                children: 'a',
                pswpModule: PhotoSwipe,
                
                // Basic UI options
                showHideAnimationType: 'fade',
                bgOpacity: 0.85,
                
                // Disable built-in captions to use our custom solution
                captionEl: false,
                
                // Control buttons
                closeEl: true,
                zoomEl: true,
                shareEl: false,
                counterEl: true,
                arrowEl: true,
                fullscreenEl: true,
                
                // Image click behavior
                imageClickAction: 'zoom',
                tapAction: 'close',
                doubleTapAction: 'zoom',
                
                // Important for sizing - leave no bottom padding since caption will be positioned separately
                paddingFn: () => {
                    return {
                        top: 30,
                        bottom: 0,
                        left: 0,
                        right: 0
                    };
                }
            });
            
            // Add our custom caption UI element
            lightbox.on('uiRegister', function() {
                lightbox.pswp.ui.registerElement({
                    name: 'custom-caption',
                    order: 9,
                    isButton: false,
                    appendTo: 'root',
                    html: '',
                    onInit: (el, pswp) => {
                        // Create caption container
                        const captionContainer = document.createElement('div');
                        captionContainer.className = 'custom-caption-container';
                        el.appendChild(captionContainer);
                        
                        // Caption positioning function
                        const positionCaption = () => {
                            if (!pswp.currSlide) return;
                            
                            const slideData = pswp.currSlide.data;
                            const captionText = slideData.element.dataset.pswpCaption;
                            
                            // Only show caption if we have text
                            if (!captionText) {
                                captionContainer.style.display = 'none';
                                return;
                            }
                            
                            // Get current slide content
                            const imageContainer = pswp.currSlide.holderElement;
                            const image = pswp.currSlide.content.element;
                            
                            if (!imageContainer || !image) return;
                            
                            // Get viewport size
                            const viewportHeight = pswp.viewportSize.y;
                            const viewportWidth = pswp.viewportSize.x;
                            
                            // Calculate the available space (account for top bar)
                            const availableHeight = viewportHeight - 30; // 30px for top bar
                            
                            // Calculate caption height (estimate with padding)
                            const captionHeight = 80; // Approximate height with padding and text
                            
                            // Calculate maximum image height to leave room for caption
                            const maxImageHeight = availableHeight - captionHeight;
                            
                            // Determine image display dimensions
                            const imageWidth = image.offsetWidth;
                            const imageHeight = image.offsetHeight;
                            
                            // Set caption width to match the image width
                            const captionWidth = imageWidth;
                            
                            // Get the image position
                            const imageRect = image.getBoundingClientRect();
                            
                            // Position caption directly below the image
                            captionContainer.style.cssText = `
                                background: rgba(0, 0, 0, 0.75);
                                color: #fff;
                                position: absolute;
                                width: ${captionWidth}px;
                                left: ${imageRect.left}px;
                                top: ${imageRect.bottom}px;
                                text-align: left;
                                padding: 15px;
                                font-size: 16px;
                                z-index: 9999;
                                box-sizing: border-box;
                            `;
                            
                            captionContainer.textContent = captionText;
                            captionContainer.style.display = 'block';
                        };
                        
                        // Listen for relevant events
                        pswp.on('change', positionCaption);
                        pswp.on('resize', positionCaption);
                        pswp.on('zoomPanUpdate', positionCaption);
                        pswp.on('beforeZoomTo', positionCaption);
                        pswp.on('afterZoomTo', positionCaption);  // Add this line
                        
                        // Ensure caption is positioned after a slight delay for image rendering
                        pswp.on('afterInit', () => {
                            setTimeout(positionCaption, 100);
                        });
                        
                        // Additional positioning on slide transitioning
                        pswp.on('slideInit', () => {
                            setTimeout(positionCaption, 50);
                        });
                        
                        // Add periodic repositioning for reliability
                        let captionInterval;
                        pswp.on('firstUpdate', () => {
                            captionInterval = setInterval(positionCaption, 200);
                        });
                        
                        pswp.on('destroy', () => {
                            if (captionInterval) clearInterval(captionInterval);
                        });
                    }
                });
            });
            
            // Add custom styles to ensure images display properly
            lightbox.on('beforeOpen', () => {
                // Inject custom styles for better image display
                const styleEl = document.createElement('style');
                styleEl.id = 'photoswipe-custom-styles';
                styleEl.textContent = `
                    .pswp__img {
                        max-height: calc(100vh - 110px) !important; /* Leave space for top bar and caption */
                        object-fit: contain !important;
                    }
                    
                    .pswp__zoom-wrap {
                        position: absolute;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        width: 100%;
                        height: 100%;
                    }
                    
                    .pswp__item {
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                    }
                `;
                document.head.appendChild(styleEl);
            });
            
            // Clean up styles when the lightbox closes
            lightbox.on('close', () => {
                const styleEl = document.getElementById('photoswipe-custom-styles');
                if (styleEl) styleEl.remove();
            });
            
            // Update dimensions for PhotoSwipe
            window.addEventListener('load', function() {
                const links = document.querySelectorAll('.gallery a');
                links.forEach(link => {
                    const img = link.querySelector('img');
                    if (img && img.complete) {
                        if (!link.dataset.pswpWidth || !link.dataset.pswpHeight) {
                            link.dataset.pswpWidth = img.naturalWidth || 1200;
                            link.dataset.pswpHeight = img.naturalHeight || 800;
                        }
                    }
                });
            });
            
            // Initialize PhotoSwipe
            lightbox.init();
            
            // Handle window resize
            window.addEventListener('resize', adjustImageRowHeights);
        });
    </script>
</body>
</html>